> [!NOTE] 
> ~~Шизофрения~~ политика админа вашей хуйни ~~снова~~ изменилась – мы постараемся больше не прибегать к использованию модулей с закрытым исходным кодом для скрытия root-доступа и/или прохождения тех или иных проверок.  
>
> Как минимум потому что это попросту ненужно: все известные мне приложения исправно работают без ограничений, используя открытые решения, для настройки которых требуется минимальное количество усилий.  
> Как максимум (и вполе объективный), закрытые модули с полным доступом к устройству и всем данным на нём – это не очень-то и безопасно, а поскольку можно спокойно обойтись и без них, выбор становится очевиден.

# Первоначальная настройка 

## Скрытие root-прав

Актуально на момент последнего редактирования для всех российских приложений (ноябрь 2024).

1. Устанавливаем последнюю версию [официального Magisk.](https://github.com/topjohnwu/Magisk/releases)
2. Включаем Zygisk в настройках и отключаем (если включали) DenyList, перезагружаем девайс.
3. Устанавливаем модули [Sensitive Props](https://www.pling.com/p/2129780/) и [Zygisk Assistant,](https://github.com/snake-4/Zygisk-Assistant) перезагружаемся.
4. Приложения, от которых нужно скрыть root-права, отмечаем галочками в пункте выбора приложений для DenyList. Сама функция DenyList по-прежнему должна быть отключена!

Если у вас LineageOS или прошивка на её основе, рекомендуется [скрыть файл addon.d.](#скрываем-addond-в-lineageos)

## Рекомендуемые модули
* [LSPosed-Irena.](https://github.com/re-zero001/LSPosed-Irena/) Обновляемый форк LSPosed, защищенный от обнаружения приложениями.

# Опциональное

## Скрытие следов монтирования модулей
Устанавливаем [Memory Detector](https://github.com/rushiranpise/detection/blob/main/MemoryDetector_2.1.0.apk) и прикрепленную версию модуля [Magisk OverlayFS.](https://github.com/reddxae/list/blob/files/apatch-stuff/magisk-overlayfs-release_v3.2.2-fixed.zip) **Другие версии не работают с новым Magisk!** Перезагружаем устройство.
1. Открываем архив с модулем и переходим к файлу customize.sh. Если такого нет, создаём.
2. Перед завершением установки модуля (это последняя строчка, обычно `exit`, либо же просто конец файла) добавляем следующий скрипт:
```
OVERLAY_IMAGE_EXTRA=0
OVERLAY_IMAGE_SHRINK=true

if [ -f "/data/adb/modules/magisk_overlayfs/util_functions.sh" ] && \
    /data/adb/modules/magisk_overlayfs/overlayfs_system --test; then
  ui_print "- Add support for overlayfs"
  . /data/adb/modules/magisk_overlayfs/util_functions.sh
  support_overlayfs && rm -rf "$MODPATH"/system
fi
```

3. Сохраняем отредактированный файл и переносим его в установочный архив с заменой. 
4. Устанавливаем модуль. Если всё успешно (вы правильно вставили скрипт, а модуль поддерживает установку через OverlayFS), в логе установки будет схожий вывод, как при установке самого модуля OverlayFS.
5. Перезагружаем устройство и проверяем:
   - сам модуль, всё ли работает корректно;
   - обнаружение файлов в Memory Detector – должен быть вывод: *Looks fine! Nothing is found.*
   
Скрывать монтирование ReVanced вручную больше не нужно, за вас это автоматически делает модуль Zygisk Assistant.

## Скрываем addon.d в LineageOS
1. Устанавливаем прикрепленную версию модуля [Magisk OverlayFS.](https://github.com/reddxae/list/blob/files/apatch-stuff/magisk-overlayfs-release_v3.2.2-fixed.zip) **Другие версии не работают с новым Magisk!** Перезагружаем устройство.
2. После установки модуля, в оболочке (проще говоря adb shell) выполните команду: `su -mm -c magic_remount_rw`.
3. **Если Вы на кастомной прошивке,** переходим в файловый менеджер с поддержкой root (рекомендуется [Material Files](https://github.com/zhanghai/MaterialFiles)), переходим в папку /system/addon.d и удаляем все файлы из этой папки. Меняем права для папки на 0000 (снимаем все галочки для всех юзеров).
4. Выполняем в оболочке команду `su -mm -c magic_remount_ro`.
5. Проходим по пути /data/adb/modules/magisk_overlayfs и открываем текстовым редактором файл *mode.sh*, находим строчку `export OVERLAY_MODE=`, меняем значение с `0` на `2`. Перезагружаем устройство.
